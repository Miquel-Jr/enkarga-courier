<style>
  .carousel-container {
    overflow: hidden;
    margin: auto;
  }

  .carousel {
    display: flex;
    transition: transform 0.5s ease-in-out;
  }

  .form-card {
    width: 85%;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    margin: 10px;
    padding: 20px;
    background-color: #fff;
    flex-shrink: 0;
  }
</style>

<form id="buscarGuia" class="">
  <div class="card">
    <h5 class="card-header h5">Actualizar Guia</h5>
    <div class="card-body">
      <div class="form-row">
        <div class="col-12 col-md-12 form-group text-center">
          <label class="col-form-label font-weight-bold" for="guia">Guia</label>
          <select class="form-control w-50 mx-auto selectpicker" data-live-search="true" id="guia"></select>
          <small id="guiaHelp" class="form-text text-muted">Ejemplo: 001 - 00000012.</small>
        </div>
        <input type="hidden" id="estadoInicialGuia" value="0">
      </div>
    </div>
  </div>

  <div class="form-inline justify-content-center">
    <button type="button" onclick="mostrarLoader();return false" class="btn btn-guardar disabled" id="buscarGuiaButton">
      Buscar
    </button>
  </div>
</form>

<form id="informacionGuia" class="d-none">
  <!--DATOS PRINCIPALES-->
  <div class="card">
    <div class="card-body">
      <div class="row justify-content-center">
        <!--TITULO DE LA VISTA-->
        <div class="col-12 col-md-8 text-center">
          <h3 class="h3-responsive titulo font-weight-bold">Actualizar Datos Guia</h3>
        </div>

        <div class="w-100"></div>

        <!--INFORMACION GENERAL DEL CLIENTE-->
        <div class="col-12 col-md-5 col-xl-4 form-group text-center">
          <!--CODIGO-->
          <h6>Guia: <span id="codigo">000000</span></h6>

          <!--F. REGISTRO EN EL SISTEMA-->
          <h6>Fecha de registro: <span id="fechaRegistro"></span></h6>
        </div>
      </div>
    </div>
  </div>

  <!--DATOS GENERALES-->
  <div class="card">
    <h5 class="card-header h5">Datos Generales</h5>
    <div class="card-body">
      <div class="form-row">

        <!-- ESTADOS GUIA -->
        <div class="col-12 col-md form-group">
          <label class="col-form-label font-weight-bold" for="estadosGuia">Estado Guia</label>
          <select class="form-control mx-auto selectpicker" data-live-search="true" id="estadosGuia"></select>
          <small id="estadosGuiaHelp" class="form-text text-muted">Campo obligatorio.</small>
        </div>

        <!-- ACTUALIZAR -->
        <button type="button" class="btn btn-default w-25 my-4 disabled" id="actualizarEstadoGuia"
          onclick="mostrarLoaderActualizarEstadoGuia();return false">
          Actualizar Estado Guia
        </button>

        <div class="w-100"></div>
      </div>
    </div>
  </div>
</form>

<div id="carousel-guia" class="carousel-container d-none">
  <div class="carousel" id="carousel">

    <!-- ESTADO 1 -->
    <form class="form-card">
      <!-- DATOS GUIA -->
      <div class="card" id="datosInformativoGuia">
        <h5 class="card-header h5">Datos Informativos</h5>
        <div class="card-body">
          <div class="form-row">
            <!-- SERIE -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="serieGuia">Serie</label>
              <input required id="serieGuia" onkeyup="obtenerMayuscula(this);" class="form-control disabled"
                type="string" aria-describedby="serieHelp" placeholder="Ingresar serie de la guia" />
              <small id="serieHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- NUMERO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="numeroGuia">Numero</label>
              <input required id="numeroGuia" onblur="autoCompletarCeros(this);" class="form-control disabled"
                type="string" maxlength="8" aria-describedby="numeroHelp" placeholder="Ingresar numero de la guia" />
              <small id="numeroHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- FECHA EMISION -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="fechaEmision">Fecha Emision</label>
              <input required id="fechaEmision" class="form-control" type="date" aria-describedby="fechaEmisionHelp"
                placeholder="Ingresar fecha de emision de la guia" />
              <small id="fechaEmisionHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- TRANSPORTISTA -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="transportista">Personal - Transportista</label>
              <select required id="transportista" class="form-control" aria-describedby="transportistaHelp">
              </select>
              <small id="transportistaHelp" class="form-text text-muted">Campo opcional.</small>
            </div>

            <div class="w-100"></div>

            <!-- CLIENTE -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="cliente">Cliente</label>
              <select required id="cliente" class="form-control" aria-describedby="clienteHelp">
              </select>
              <small id="clienteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- ORDEN COMPRA -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="ordenCompra">Orden de compra</label>
              <input id="ordenCompra" class="form-control " type="string" aria-describedby="ordenCompraHelp"
                placeholder="Ingresar orden de compra de la guia" />
              <small id="ordenCompraHelp" class="form-text text-muted">Campo opcional.</small>
            </div>

            <!-- COTIZACION -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="cotizacion">Cotizacion</label>
              <input id="cotizacion" class="form-control " type="string" aria-describedby="cotizacionHelp"
                placeholder="Ingresar codigo de cotizacion de la guia" />
              <small id="cotizacionHelp" class="form-text text-muted">Campo opcional.</small>
            </div>

            <div class="w-100"></div>

            <!-- REMITENTE -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="remitente">Remitente</label>
              <select required id="remitente" onchange="mostrarRemitente(this.value)" class="form-control"
                aria-describedby="remitenteHelp">
                <option disabled selected>Elegir Cliente</option>
              </select>
              <small id="remitenteHelp" class="form-text text-muted">Campo opcional.</small>
            </div>

            <!-- RAZON SOCIAL - REMITENTO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="razonSocialRemitente">Razon Social - Remitente</label>
              <input required id="razonSocialRemitente" class="form-control disabled" type="string"
                aria-describedby="razonSocialRemitenteHelp" placeholder="Ingresar razon social - remitente" />
              <small id="razonSocialRemitenteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- RUC - REMITENTO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="rucRemitente">RUC - Remitente</label>
              <input required id="rucRemitente" class="form-control disabled" type="string"
                aria-describedby="rucRemitenteHelp" placeholder="Ingresar ruc - remitente" />
              <small id="rucRemitenteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <div class="w-100"></div>

            <!-- DIRECCION DE PARTIDO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="direccionRemitente">Direccion Partida -
                Remitente</label>
              <input required id="direccionRemitente" onkeyup="obtenerMayuscula(this);" class="form-control"
                type="string" aria-describedby="direccionRemitenteHelp" placeholder="Ingresar direccion de partida" />
              <small id="direccionRemitenteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <div class="w-100"></div>

            <!-- DESTINATARIO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="destinatario">Destinatario</label>
              <select required id="destinatario" onchange="mostrarDestinatario(this.value)" class="form-control"
                aria-describedby="destinatarioHelp">
                <option disabled selected>Elegir Cliente</option>
              </select>
              <small id="destinatarioHelp" class="form-text text-muted">Campo opcional.</small>
            </div>

            <!-- RAZON SOCIAL - DESTINATARIO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="razonSocialDestinatario">Razon Social -
                Destinatario</label>
              <input required id="razonSocialDestinatario" class="form-control disabled" type="string"
                aria-describedby="razonSocialDestinatarioHelp" placeholder="Ingresar razon social - destinatario" />
              <small id=" razonSocialDestinatarioHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- RUC - DESTINATARIO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="rucDestinatario">RUC - Destinatario</label>
              <input required id="rucDestinatario" class="form-control disabled" type="string"
                aria-describedby="rucDestinatarioHelp" placeholder="Ingresar ruc - destinatario" />
              <small id="rucDestinatarioHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <div class="w-100"></div>

            <!-- DIRECCION DESTINATARIO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="direccionDestinatario">Direccion de Llegada -
                Destinatario</label>
              <input required id="direccionDestinatario" onkeyup="obtenerMayuscula(this);" class="form-control"
                type="string" aria-describedby="direccionDestinatarioHelp"
                placeholder="Ingresar direccion de llegada" />
              <small id="direccionDestinatarioHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <div class="w-100"></div>

          </div>
        </div>
      </div>

      <!--DATOS GUIA DETALLES -->
      <div class="card">
        <h5 class="card-header h5">Datos Guia Detalle</h5>
        <div class="card-body">
          <div class="form-row">

            <!-- DESCRIPCION -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="descripcionItem">Descripcion</label>
              <input required id="descripcionItem" onkeyup="obtenerMayuscula(this);" class="form-control" type="string"
                onchange="mostrarOpcionRegistrarGuiaDetalle();" aria-describedby="descripcionItemHelp"
                placeholder="Ejm: Medicinas" />
              <small id="descripcionItemHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- CANTIDAD -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="cantidadItem">Cantidad</label>
              <input required id="cantidadItem" class="form-control" type="number" aria-describedby="cantidadItemHelp"
                onchange="mostrarOpcionRegistrarGuiaDetalle();" placeholder="Ejm: 1" />
              <small id="cantidadItemHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- UNIDAD -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="unidadItem">Unidad de Medida</label>
              <input required id="unidadItem" onkeyup="obtenerMayuscula(this);" class="form-control" type="string"
                onchange="mostrarOpcionRegistrarGuiaDetalle();" aria-describedby="unidadItemHelp"
                placeholder="Ejm: CAJA, PAQUETE, SOBRE" />
              <small id="unidadItemHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- PESO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="pesoItem">Peso</label>
              <input required id="pesoItem" onkeyup="obtenerMayuscula(this);" class="form-control" type="string"
                onchange="mostrarOpcionRegistrarGuiaDetalle();" aria-describedby="pesoItemHelp"
                placeholder="Ejm: 2 Kgrs." />
              <small id="pesoItemHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <button type="button" onclick="registrarListadoGuiaDetalle();return false"
              class="btn btn-secondary disabled guiaDetalle">
              Agregar
            </button>

            <div class="w-100"></div>

          </div>
        </div>
      </div>

      <!--RESUMEN GUIA DETALLE -->
      <div class="card">
        <h5 class="card-header h5">Resumen Guia Detalle</h5>
        <div class="card-body">
          <div class="form-row">

            <table id="tablaDetalles" class="table table-striped table-bordered" cellspacing="0" width="100%">
              <thead>
                <tr>
                  <th class='th-sm' width="55%">DESCRIPCION</th>
                  <th class='th-sm' width="15%">UNIDAD</th>
                  <th class='th-sm' width="15%">CANTIDAD</th>
                  <th class='th-sm' width="15%">PESO</th>
                </tr>
              </thead>
              <tbody id="cuerpoTabla">
                <tr>
                </tr>
              </tbody>
            </table>

            <div class="w-100"></div>

          </div>
        </div>
      </div>

      <!--DATOS GUIA -->
      <div class="card">
        <h5 class="card-header h5">Datos Guia</h5>
        <div class="card-body">
          <div class="form-row">

            <!-- LARGO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="largoGuia">Largo</label>
              <input id="largoGuia" onkeyup="obtenerMayuscula(this);" class="form-control" type="string"
                aria-describedby="largoGuiaHelp" placeholder="Ejm: 10 cm" />
              <small id="largoGuiaHelp" class="form-text text-muted">Campo opcional.</small>
            </div>

            <!-- ANCHO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="anchoGuia">Ancho</label>
              <input id="anchoGuia" onkeyup="obtenerMayuscula(this);" class="form-control" type="string"
                aria-describedby="anchoGuiaHelp" placeholder="Ejm: 10 cm" />
              <small id="anchoGuiaHelp" class="form-text text-muted">Campo opcional.</small>
            </div>

            <!-- ALTO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="altoGuia">Alto</label>
              <input id="altoGuia" onkeyup="obtenerMayuscula(this);" class="form-control" type="string"
                aria-describedby="altoGuiaHelp" placeholder="Ejm: 10 cm" />
              <small id="altoGuiaHelp" class="form-text text-muted">Campo opcional.</small>
            </div>

            <div class="w-100"></div>

          </div>
        </div>
      </div>

      <!--OPCIONES DEL FORMULARIO-->
      <div id="opcionesFormulario" class="form-inline justify-content-center">
        <button type="button" onclick="mostrarLoaderActualizarGuia();return false" class="btn btn-guardar">
          Actualizar
        </button>
      </div>
    </form>

    <!-- ESTADO 2 -->
    <form class="form-card">
      <!-- DATOS TRANSPORTE -->
      <div class="card">
        <h5 class="card-header h5">Datos Transporte</h5>
        <div class="card-body">
          <div class="form-row">

            <input type="hidden" id="codigoGuiaTransporte" value="0">

            <!-- EMPRESA TRANSPORTE -->

            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="proveedores">Empresa Transporte</label>
              <select required id="proveedores" class="form-control" aria-describedby="proveedoresHelp">
              </select>
              <small id="proveedoresHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- FECHA EMISION -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="fechaDespacho">Fecha Despacho</label>
              <input required id="fechaDespacho" class="form-control" type="date" aria-describedby="fechaDespachoHelp"
                placeholder="Ingresar fecha de despacho" />
              <small id="fechaDespachoHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <div class="w-100"></div>

            <!-- NRO GUIA TRANSPORTE -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="nroGuiaTransporte">Nro Guia Transporte</label>
              <input id="nroGuiaTransporte" class="form-control " type="string" aria-describedby="nroGuiaTransporteHelp"
                placeholder="Ingresar numero guia transporte" />
              <small id="nroGuiaTransporteHelp" class="form-text text-muted">Campo opcional.</small>
            </div>

            <!-- NRO FACTURA TRANSPORTE -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="nroFacturaTransporte">Nro Factura Transporte</label>
              <input id="nroFacturaTransporte" class="form-control " type="string"
                aria-describedby="nroFacturaTransporteHelp" placeholder="Ingresar numero factura transporte" />
              <small id="nroFacturaTransporteelp" class="form-text text-muted">Campo opcional.</small>
            </div>

            <!-- ESTADO FACTURA -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="estadoGuiaTransporte">Estado Factura</label>
              <select required id="estadoGuiaTransporte" class="form-control"
                aria-describedby="estadoGuiaTransporteHelp">
              </select>
              <small id="estadoGuiaTransporteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <div class="w-100"></div>

            <!-- ORIGEN -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="origenTransporte">Origen</label>
              <input required id="origenTransporte" class="form-control" type="string"
                aria-describedby="origenTransporteHelp" placeholder="Ingresar origen transporte">
              <small id="origenTransporteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- DESTINO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="destinoTransporte">Destino</label>
              <input required id="destinoTransporte" class="form-control" type="string"
                aria-describedby="destinoTransporteHelp" placeholder="Ingresar origen transporte">
              <small id="destinoTransporteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- REPARTO -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="repartoTransporte">Reparto</label>
              <select required id="repartoTransporte" class="form-control" aria-describedby="repartoTransporteHelp">
                <option value="NO" selected>NO</option>
                <option value="SI">SI</option>
              </select>
              <small id="repartoTransporteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <div class="w-100"></div>

            <!-- DESCRIPCION TRANSPORTE-->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="descripcionTransporte">Descripcion</label>
              <textarea required id="descripcionTransporte" class="form-control " type="string"
                aria-describedby="descripcionTransporteHelp" placeholder="Ingresar descripcion"></textarea>
              <small id="descripcionTransporteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- CANTIDAD BULTO TRANSPORTE-->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="cantidadBultoTransporte">Cantidad Bulto</label>
              <input required id="cantidadBultoTransporte" class="form-control " type="number"
                aria-describedby="cantidadBultoTransporteHelp" placeholder="Ingresar cantidad bulto transporte" />
              <small id="cantidadBultoTransporteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <div class="w-100"></div>

            <!-- OBSERVACIONES TRANSPORTE-->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="observacionesTransporte">Observaciones</label>
              <textarea required id="observacionesTransporte" class="form-control " type="string"
                aria-describedby="observacionesTransporteHelp" placeholder="Ingresar observaciones"></textarea>
              <small id="observacionesTransporteHelp" class="form-text text-muted">Campo opcional.</small>
            </div>

            <div class="w-100"></div>

            <!-- SUBTOTAL TRANSPORTE-->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="subtotalTransporte">Subtotal</label>
              <input required id="subtotalTransporte" class="form-control " type="number" step="0.01"
                aria-describedby="subtotalTransporteHelp" placeholder="Ingresar subtotal guia transporte" />
              <small id="subtotalTransporteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- IGV TRANSPORTE -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="igvTransporte">IGV</label>
              <input required id="igvTransporte" class="form-control disabled" type="number" step="0.01"
                aria-describedby="igvTransporteHelp" placeholder="Ingresar igv guia transporte" />
              <small id="igvTransporteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <!-- TOTAL TRANSPORTE -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="totalTransporte">Total</label>
              <input required id="totalTransporte" class="form-control " type="number" step="0.01"
                aria-describedby="totalTransporteHelp" placeholder="Ingresar total guia transporte" />
              <small id="totalTransporteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <div class="w-100"></div>

            <!-- TIPO TRANSPORTE -->
            <div class="col-12 col-md form-group">
              <label class="col-form-label font-weight-bold" for="tipoTransporte">Tipo Transporte</label>
              <select required id="tipoTransporte" class="form-control" aria-describedby="tipoTransporteHelp">
                <option value="AEREO" selected>AEREO</option>
                <option value="TERRESTRE">TERRESTRE</option>
                <option value="EXPRESO">EXPRESO</option>
              </select>
              <small id="tipoTransporteHelp" class="form-text text-muted">Campo obligatorio.</small>
            </div>

            <div class="w-100"></div>

          </div>
        </div>
      </div>

      <!--OPCIONES DEL FORMULARIO-->
      <div class="form-inline justify-content-center">
        <button id="registrarTransporte" type="button" onclick="validarFormularioTransporte();return false"
          class="btn btn-guardar d-none">
          Registrar
        </button>
      </div>
      <div class="form-inline justify-content-center">
        <button id="actualizarTransporte" type="button" onclick="validarFormularioTransporteActualizar();return false"
          class="btn btn-reset d-none">
          Actualizar
        </button>
      </div>
    </form>

    <!-- ESTADO 3 -->
    <form class="form-card">
      <div class="container font-weight-bold h3-responsive principal-text text-center">
        LA GUIA SE ENCUENTRA EN TRANSITO.
      </div>
    </form>

    <!-- ESTADO 4 -->
    <form class="form-card">
      <div class="container font-weight-bold h3-responsive principal-text text-center">
        LA GUIA YA SE ENCUENTRA EN EL DISTRITO DE ENTREGA.
      </div>
    </form>

    <!-- ESTADO 5 -->
    <form class="form-card">
      <div class="container font-weight-bold h3-responsive principal-text text-center">
        EL CLIENTE CONFIRMÓ LA ENTREGA DE LA GUIA.
      </div>
    </form>

    <!-- ESTADO 6 -->
    <form class="form-card">
      <div class="container font-weight-bold h3-responsive principal-text text-center">
        LA GUIA YA SE ENCUENTRA DISPONIBLE PARA FACTURAR.
      </div>
    </form>
    <form class="form-card">
      <div class="container font-weight-bold h3-responsive principal-text text-center">
        LA GUIA SERÁ CANCELADA POR EL USUARIO.
      </div>
    </form>

  </div>
</div>

<div id="loader"></div>
<!--ARCHIVOS JS DE LA VISTA-->
<script src="Bootstrap/js/select2.min.js"></script>
<link href="Bootstrap/css/select2.min.css" rel="stylesheet" />
<script type="text/javascript" src="Modulos/ModGuia/VistaGuia.js"></script>
<script type="text/javascript" src="Modulos/ModClientes/VistaClientes.js"></script>
<script type="text/javascript" src="Bootstrap/js/tablaDinamica.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/validator/13.6.0/validator.min.js"></script>

<!-- SCRIPTS CARGA DE DOCUMENTOS -->
<script type="text/javascript">

  mostrarListadoDatosGuia();
  mostrarListadoEstadosGuia();

  /*=============================================
    - MOSTRAR BOTON DE BUSQUEDA
  =============================================*/

  $("#guia").change(function () {
    const guia = $("#guia").val();
    if (guia.length !== 0) {
      document.getElementById("buscarGuiaButton").classList.remove("disabled");
    }
  });

  $("#subtotalTransporte").change(function () {
    const subtotalTransporte = $("#subtotalTransporte").val();
    if (subtotalTransporte.length !== 0) {
      const igvTransporte = Number(subtotalTransporte) * 0.18;
      const totalTransporte = Number(subtotalTransporte) * 1.18;
      $("#subtotalTransporte").val(Number(subtotalTransporte).toFixed(2));
      $("#igvTransporte").val(igvTransporte.toFixed(2));
      $("#totalTransporte").val(totalTransporte.toFixed(2));
    } else {
      $("#subtotalTransporte").val("0.00");
      $("#igvTransporte").val("0.00");
      $("#totalTransporte").val("0.00");
    }
  });

  $("#totalTransporte").change(function () {
    const totalTransporte = $("#totalTransporte").val();
    if (totalTransporte.length !== 0) {
      const subtotalTransporte = Number(totalTransporte) / 1.18;
      const igvTransporte = Number(subtotalTransporte) * 0.18;
      $("#subtotalTransporte").val(subtotalTransporte.toFixed(2));
      $("#igvTransporte").val(igvTransporte.toFixed(2));
      $("#totalTransporte").val(Number(totalTransporte).toFixed(2));
    } else {
      $("#subtotalTransporte").val("0.00");
      $("#igvTransporte").val("0.00");
      $("#totalTransporte").val("0.00");
    }
  });

  /*=============================================
    - MOSTRAR FORMULARIO/BOTON POR ESTADO GUIA
  =============================================*/

  $("#estadosGuia").change(function () {
    const estadoGuia = Number($("#estadosGuia").val());
    const estadoInicialGuia = Number($("#estadoInicialGuia").val());
    if (estadoGuia > estadoInicialGuia) {
      document.getElementById("actualizarEstadoGuia").classList.remove("disabled");
    } else {
      document.getElementById("actualizarEstadoGuia").classList.add("disabled");
    }
    if (estadoGuia === 2) {
      setTimeout(cargarDocumentosEstadoPreparado, 700);
    }
    const carousel = document.getElementById('carousel');
    const formWidth = document.querySelector('.form-card').clientWidth;
    carousel.style.transform = `translateX(${-(estadoGuia - 1) * formWidth}px)`;
  });

  /*=============================================
    - MOSTRAR LISTADO DE SEGUIMIENTO GUIA
  =============================================*/

  async function mostrarListadoDatosGuia() {
    const datos = await cargarListadoGuiaVigentes();
    var tablaGuia =
      "<option value = 0 selected disabled> Elegir Guia</option>";
    if (Array.isArray(datos)) {
      for (const guia of datos) {
        tablaGuia += `
          <option value=${guia.id_guia}>
            ${guia.serie_guia} - ${guia.numero_guia}
          </option>
        `;
      }
    }
    $("#guia").html(tablaGuia);
    $("#guia").select2();
  }

  /*=============================================
    - MOSTRAR LISTADO DE ESTADOS GUIA
  =============================================*/

  async function mostrarListadoEstadosGuia() {
    const datos = await cargarEstadosGuia();
    var tablaEstados = "";

    for (const estados of datos) {
      tablaEstados += `
      <option value=${estados.id_estado_guia}>${estados.descripcion} - ${estados.detalle}</option>
      `
    }

    $("#estadosGuia").html(tablaEstados);
  }

  /*=============================================
    - MOSTRAR LOADER
  =============================================*/

  function mostrarLoader() {
    document.getElementById("loader").style.display = "block";
    setTimeout(mostrarDatosGuia, 1500);
  }

  /*=============================================
    - CERRAR LOADER
  =============================================*/

  function cerrarLoader() {
    document.getElementById("loader").style.display = "none";
  }

  /*=============================================
    - MOSTRAR DATOS GUIA
  =============================================*/

  async function mostrarDatosGuia() {
    const datos = await cargarDatosGuiaId({
      _idGuia: $("#guia").val()
    })

    document.getElementById("buscarGuia").classList.add("d-none");
    document.getElementById("informacionGuia").classList.remove("d-none");
    document.getElementById("carousel-guia").classList.remove("d-none");
    const carousel = document.getElementById('carousel');
    const formWidth = document.querySelector('.form-card').clientWidth;
    carousel.style.transform = `translateX(${-(datos.id_estado_guia - 1) * formWidth}px)`;
    $("#codigo").html(`${datos.serie_guia} - ${datos.numero_guia}`);
    $("#fechaRegistro").html(`${datos.fecha_registro}`);
    $("#estadosGuia").val(datos.id_estado_guia);
    $("#estadoInicialGuia").val(datos.id_estado_guia);
    $("#serieGuia").val(datos.serie_guia);
    $("#numeroGuia").val(datos.numero_guia);
    $("#fechaEmision").val(datos.fecha_emision);

    await mostrarDatosTransportistas(datos.id_transportista);
    await mostrarDatosClientes(datos.id_cliente);
    await mostrarSucursalesCliente(datos.id_cliente);

    $("#ordenCompra").val(datos.orden_compra);
    $("#cotizacion").val(datos.codigo_cotizacion);

    $("#remitente").val(datos.id_sucursal_remitente).trigger('change');
    $("#direccionRemitente").val(datos.direccion_remitente);
    $("#destinatario").val(datos.id_sucursal_destinatario).trigger('change');
    $("#direccionDestinatario").val(datos.direccion_destinatario);

    await mostrarDatosDetalleGuia(datos.id_guia);

    $("#largoGuia").val(datos.largo_guia);
    $("#anchoGuia").val(datos.ancho_guia);
    $("#altoGuia").val(datos.alto_guia);

    if (datos.id_estado_guia === 2) {
      await cargarDocumentosEstadoPreparado();
    }

    setTimeout(() => {
      $("#cliente").select2();
      $("#transportista").select2();
    }, 1200);

    cerrarLoader();

  }

  /*=============================================
    - MOSTRAR DATOS CLIENTES
  =============================================*/

  async function mostrarDatosClientes(id_cliente) {
    const datos = await cargarDatosClientesActivos();
    var tablaClientes =
      "<option value = 0 disabled> Elegir Cliente</option>";
    if (Array.isArray(datos)) {
      for (const cliente of datos) {
        if (id_cliente === cliente.id_cliente) {
          tablaClientes += `
            <option value=${cliente.id_cliente} selected>
              ${cliente.nombres} ${cliente.apellidos}
            </option>
          `;
        } else {
          tablaClientes += `
            <option value=${cliente.id_cliente}>
              ${cliente.nombres} ${cliente.apellidos}
            </option>
          `;
        }
      }
    }
    $("#cliente").html(tablaClientes);
  }

  /*=============================================
    - MOSTRAR DATOS CLIENTE - SUCURSALES
  =============================================*/

  async function mostrarSucursalesCliente(idCliente) {
    const sucursales = await mostradoListadoSucursal({
      _idCliente: idCliente
    });
    let tablaSucursales = "<option value = '0' selected disabled>Elegir Sucursales</option>";
    if (sucursales.response === 0) {
      Swal.fire({
        icon: "warning",
        title: "Cliente - Sucursales",
        text: sucursales.message,
      });
      listadoSucursales = [];
      $("#direccionRemitente").val("");
      $("#razonSocialRemitente").val("");
      $("#rucRemitente").val("");
      $("#direccionDestinatario").val("");
      $("#razonSocialDestinatario").val("");
      $("#rucDestinatario").val("");
    } else {
      for (const sucursal of sucursales) {
        tablaSucursales += `<option value = '${sucursal.id_cliente_sucursal}'> ${sucursal.departamento} - ${sucursal.distrito} - ${sucursal.distrito}</option>`;
      }
      listadoSucursales = sucursales;
    }
    $("#remitente").html(tablaSucursales);
    $("#remitente").select2();
    $("#destinatario").html(tablaSucursales);
    $("#destinatario").select2();

  }

  /*=============================================
    - MOSTRAR DATOS PERSONAL - TRANSPORTISTA
  =============================================*/

  async function mostrarDatosTransportistas(id_transportista) {
    const datos = await cargarDatosTransportistasActivos();
    var tablaTransportistas =
      "<option value = 0 selected> Elegir Transportista</option>";
    if (Array.isArray(datos)) {
      for (const transportista of datos) {
        if (id_transportista === transportista.id_personal) {

          tablaTransportistas += `
            <option value=${transportista.id_personal} selected>
              ${transportista.nombres} ${transportista.apellidos}
            </option>
          `;
        } else {

          tablaTransportistas += `
            <option value=${transportista.id_personal}>
              ${transportista.nombres} ${transportista.apellidos}
            </option>
          `;
        }
      }
    }
    $("#transportista").html(tablaTransportistas);
  }

  /*=============================================
    - MOSTRAR DATOS DETALLES - GUIA
  =============================================*/

  async function mostrarDatosDetalleGuia(id_guia) {
    const datos = await cargarGuiaDetalleIdGuia({
      _idGuia: id_guia
    });
    var tablaGuiaDetalles = "";
    if (Array.isArray(datos)) {
      for (const guiaDetalles of datos) {
        tablaGuiaDetalles += `
        <tr onclick="opcionesGuiaDetalles('${guiaDetalles.id_guia_detalle}', '${id_guia}')">
          <td class="text-center">${guiaDetalles.descripcion}</td>
          <td>${guiaDetalles.unidad}</td>
          <td>${guiaDetalles.cantidad}</td>
          <td>${guiaDetalles.peso}</td>
        </tr>
      `;
      }
      $("#cuerpoTabla").html(tablaGuiaDetalles);
    } else {
      $("#cuerpoTabla").html(tablaGuiaDetalles);
    }
  }

  /*=============================================
    - MOSTRAR DATOS SUCURSALES - REMITENTE
  =============================================*/

  function mostrarRemitente(id_cliente_sucursal) {
    const sucursal = listadoSucursales.find(item => item.id_cliente_sucursal === Number(id_cliente_sucursal));
    if (sucursal) {
      $("#direccionRemitente").val(sucursal.direccion);
      $("#razonSocialRemitente").val(sucursal.razon_social);
      $("#rucRemitente").val(sucursal.ruc);
    } else {
      $("#direccionRemitente").val("");
      $("#razonSocialRemitente").val("");
      $("#rucRemitente").val("");
    }
  }

  /*=============================================
    - MOSTRAR DATOS SUCURSALES - DESTINATARIO
  =============================================*/

  function mostrarDestinatario(id_cliente_sucursal) {
    const sucursal = listadoSucursales.find(item => item.id_cliente_sucursal === Number(id_cliente_sucursal));
    if (sucursal) {
      $("#direccionDestinatario").val(sucursal.direccion);
      $("#razonSocialDestinatario").val(sucursal.razon_social);
      $("#rucDestinatario").val(sucursal.ruc);
    } else {
      $("#direccionDestinatario").val("");
      $("#razonSocialDestinatario").val("");
      $("#rucDestinatario").val("");
    }
  }


  /*=============================================
    - MOSTRAR BOTON DE REGISTRO DE DETALLE
  =============================================*/

  function mostrarOpcionRegistrarGuiaDetalle() {
    const descripcionItem = $("#descripcionItem").val();
    const cantidadItem = $("#cantidadItem").val();
    const unidadItem = $("#unidadItem").val();
    const pesoItem = $("#pesoItem").val();

    if (descripcionItem.length > 0 && cantidadItem.length > 0 && unidadItem.length > 0 && pesoItem.length > 0) {
      const elements = document.querySelectorAll('.guiaDetalle');
      elements.forEach(element => {
        element.classList.remove('disabled');
      });
    } else {
      const elements = document.querySelectorAll('.guiaDetalle');
      elements.forEach(element => {
        element.classList.add('disabled');
      });
    }
  }

</script>

<!-- SCRIPTS DE ACTUALIZACIONES DE ESTADO -->
<script type="text/javascript">

  /*=============================================
    - MOSTRAR LOADER ACTUALIZAR
  =============================================*/

  function mostrarLoaderActualizarEstadoGuia() {
    document.getElementById("loader").style.display = "block";
    const estadoGuia = Number($("#estadosGuia").val());
    const estadoInicialGuia = Number($("#estadoInicialGuia").val());
    if (estadoGuia === 7) {
      if (estadoInicialGuia === 6 && estadoGuia === 7) {
        cerrarLoader();
        Swal.fire({
          icon: "error",
          title: "Guia no actualizada",
          text: "La guia se encuentra factura",
        });
      } else {
        setTimeout(actualizarEstadoGuia, 1200);
      }
    } else {
      if (estadoInicialGuia === 6 && estadoGuia === 7) {
        cerrarLoader();
        Swal.fire({
          icon: "error",
          title: "Guia no actualizada",
          text: "La guia se encuentra factura",
        });
      } else {
        setTimeout(actualizarEstadoIdGuiaFormulario, 1200);
      }
    }
  }

  /*=============================================
    - ACTUALIZAR ESTADO GUIA
  =============================================*/
  async function actualizarEstadoIdGuiaFormulario() {
    await actualizarEstadoIdGuia({
      _idGuia: $("#guia").val(),
      _idEstadoGuia: $("#estadosGuia").val()
    });
    const estadoInicialGuia = Number($("#estadoInicialGuia").val());
    const listadoEstados = await cargarEstadosGuia();
    const dataEstadoInicial = listadoEstados.find(item => item.id_estado_guia === estadoInicialGuia)
    const dataEstadoActual = listadoEstados.find(item => item.id_estado_guia === Number($("#estadosGuia").val()))
    const detalleSeguimiento = `${dataEstadoActual.descripcion} ← ${dataEstadoInicial.descripcion}`;
    await registrarSeguimientoGuia({
      _idGuia: $("#guia").val(),
      _numeroGuia: $("#codigo").html(),
      _actividad: "Se actualizó el estado por el personal logueado",
      _detalle: detalleSeguimiento,
      _idPersonal: sessionStorage.id_personal
    });
    $("#estadoInicialGuia").val($("#estadosGuia").val());
    cerrarLoader();
    Swal.fire({
      icon: "success",
      title: "Guia actualizada",
      text: "La guia se ha actualizado correctamente",
    });
  }

</script>

<!-- SCRIPTS PAGINA 1  -->
<script type="text/javascript">

  /*=============================================
    - ELMINAR GUIA DETALLE
  =============================================*/

  async function opcionesGuiaDetalles(id_guia_detalle, id_guia) {
    Swal.fire({
      title: "¿Deseas eliminar este detalle?",
      showCancelButton: true,
      confirmButtonText: "Eliminar registro",
      confirmButtonColor: "#d33",
    }).then(async (result) => {
      if (result.isConfirmed) {
        const guiaDetalles = await cargarGuiaDetalleIdGuia({
          _idGuia: id_guia
        });

        if (guiaDetalles.length === 1) {
          Swal.fire({
            icon: "error",
            title: "Detalle no eliminado",
            text: "La guia debe tener un detalle como minimo registrado.",
          });
        } else {
          const datos = await eliminarGuiaDetalle({
            _idGuiaDetalle: id_guia_detalle
          });

          if (datos.response == 0 || datosDetalle.response == 0) {
            Swal.fire({
              icon: "error",
              title: "Detalle no eliminado",
              text: datos.message,
            });
          } else {

            await mostrarDatosGuia();
            Swal.fire({
              icon: "success",
              title: "Detalle eliminado",
              text: datos.message,
            });
          }
        }
      }
    });
  }

  /*=============================================
    - MOSTRAR LOADER - ACTUALIZAR GUIA
  =============================================*/

  function mostrarLoaderActualizarGuia() {
    document.getElementById("loader").style.display = "block";
    setTimeout(validarCampos, 1500);
  }

  /*=============================================
    - VALIDAR CAMPOS - ACTUALIZAR GUIA
  =============================================*/

  async function validarCampos() {

    const serieGuia = $("#serieGuia").val();
    const numeroGuia = $("#numeroGuia").val();
    const fechaEmision = $("#fechaEmision").val();
    const transportista = $("#transportista").val();
    const cliente = $("#cliente").val();
    const ordenCompra = $("#ordenCompra").val();
    const cotizacion = $("#cotizacion").val();
    const remitente = $("#remitente").val();
    const direccionRemitente = $("#direccionRemitente").val();
    const destinatario = $("#destinatario").val();
    const direccionDestinatario = $("#direccionDestinatario").val();

    const largoGuia = $("#largoGuia").val();
    const anchoGuia = $("#anchoGuia").val();
    const altoGuia = $("#altoGuia").val();

    const info = {
      icon: "error",
      title: "Campo Inválido",
    };

    if (!fechaEmision) {
      info.text = "El campo fecha de emision debe ser seleccionado";
    } else if (cliente <= 0) {
      info.text = "El campo cliente debe ser seleccionado";
    } else if (!remitente) {
      info.text = "El campo remitente debe ser seleccionado";
    } else if (!validator.isLength(direccionRemitente, { min: 1 })) {
      info.text = "El campo direccion remitente no puede ir vacio";
    } else if (!destinatario) {
      info.text = "El campo destinatario debe ser seleccionado";
    } else if (!validator.isLength(direccionDestinatario, { min: 1 })) {
      info.text = "El campo direccion destinatario no puede ir vacio";
    }

    if (info.text) {
      cerrarLoader();
      Swal.fire(info);
      return false;
    }

    await actualizarGuiaFormulario({
      _idGuia: $("#guia").val(),
      _serieGuia: serieGuia,
      _numeroGuia: numeroGuia,
      _fechaEmision: fechaEmision,
      _idTransportista: transportista,
      _idCliente: cliente,
      _ordenCompra: ordenCompra,
      _cotizacion: cotizacion,
      _remitente: remitente,
      _direccionRemitente: direccionRemitente,
      _destinatario: destinatario,
      _direccionDestinatario: direccionDestinatario,
      _largoGuia: largoGuia,
      _anchoGuia: anchoGuia,
      _altoGuia: altoGuia
    })
  }

  /*=============================================
    - ACTUALIZAR GUIA
  =============================================*/

  async function actualizarGuiaFormulario($guia) {

    const valoresActuales = await cargarDatosGuiaId({
      _idGuia: $("#guia").val()
    });

    const $seguimiento = {
      _idGuia: $("#guia").val(),
      _numeroGuia: $("#codigo").html(),
      _actividad: "",
      _detalle: "",
      _idPersonal: sessionStorage.id_personal
    }

    if ($guia["_fechaEmision"] !== valoresActuales.fecha_emision) {
      $seguimiento._actividad = "Se actualizó la fecha de emision de la guia";
      $seguimiento._detalle = `${$guia["_fechaEmision"]} ← ${valoresActuales.fecha_emision}`;
      await registrarSeguimientoGuia($seguimiento);
    }
    if ($guia["_idTransportista"] != valoresActuales.id_transportista) {
      $seguimiento._actividad = "Se actualizó el personal de entrega de la guia";
      let transportista = "-"
      if ($guia["_idTransportista"] !== "0") {
        transportista = $('#transportista option:selected').text().trim()
      }
      $seguimiento._detalle = `${transportista} ← ${valoresActuales.transportista}`;
      await registrarSeguimientoGuia($seguimiento);
    }
    if ($guia["_idCliente"] != valoresActuales.id_cliente) {
      $seguimiento._actividad = "Se actualizó el cliente principal de la guia";
      $seguimiento._detalle = `${$('#cliente option:selected').text().trim()} ← ${valoresActuales.cliente}`;
      await registrarSeguimientoGuia($seguimiento);
    }
    if ($guia["_ordenCompra"] !== valoresActuales.orden_compra) {
      $seguimiento._actividad = "Se actualizó la orden de compra de la guia";
      $seguimiento._detalle = `${$guia["_ordenCompra"]} ← ${valoresActuales.orden_compra}`;
      await registrarSeguimientoGuia($seguimiento);
    }
    if ($guia["_cotizacion"] !== valoresActuales.codigo_cotizacion) {
      $seguimiento._actividad = "Se actualizó el codigo de cotizacion de la guia";
      $seguimiento._detalle = `${$guia["_cotizacion"]} ← ${valoresActuales.codigo_cotizacion}`;
      await registrarSeguimientoGuia($seguimiento);
    }
    if ($guia["_remitente"] != valoresActuales.id_sucursal_remitente) {
      $seguimiento._actividad = "Se actualizó el remitente de la guia";
      const historialRemitenteNuevo = listadoSucursales.find(item => item.id_cliente_sucursal === Number($guia["_remitente"]));
      const historialRemitenteActual = listadoSucursales.find(item => item.id_cliente_sucursal === Number(valoresActuales.id_sucursal_remitente));
      $seguimiento._detalle = `${historialRemitenteNuevo.razon_social} ← ${historialRemitenteActual.razon_social}`;
      await registrarSeguimientoGuia($seguimiento);
    }
    if ($guia["_direccionRemitente"] !== valoresActuales.direccion_remitente) {
      $seguimiento._actividad = "Se actualizó la direccion remitente de la guia";
      $seguimiento._detalle = `${$guia["_direccionRemitente"]} ← ${valoresActuales.direccion_remitente}`;
      await registrarSeguimientoGuia($seguimiento);
    }
    if ($guia["_destinatario"] != valoresActuales.id_sucursal_destinatario) {
      $seguimiento._actividad = "Se actualizó el destinatario de salida de la guia";
      const historialDestinatarioNuevo = listadoSucursales.find(item => item.id_cliente_sucursal === Number($guia["_destinatario"]));
      const historialDestinatarioActual = listadoSucursales.find(item => item.id_cliente_sucursal === Number(valoresActuales.id_sucursal_destinatario));
      $seguimiento._detalle = `${historialDestinatarioNuevo.razon_social} ← ${historialDestinatarioActual.razon_social}`;
      await registrarSeguimientoGuia($seguimiento);
    }
    if ($guia["_direccionDestinatario"] !== valoresActuales.direccion_destinatario) {
      $seguimiento._actividad = "Se actualizó la direccion remitente de la guia";
      $seguimiento._detalle = `${$guia["_direccionDestinatario"]} ← ${valoresActuales.direccion_destinatario}`;
      await registrarSeguimientoGuia($seguimiento);
    }
    if ($guia["_largoGuia"] !== valoresActuales.largo_guia) {
      $seguimiento._actividad = "Se actualizó el largo de la guia";
      $seguimiento._detalle = `${$guia["_largoGuia"]} ← ${valoresActuales.largo_guia}`;
      await registrarSeguimientoGuia($seguimiento);
    }
    if ($guia["_anchoGuia"] !== valoresActuales.ancho_guia) {
      $seguimiento._actividad = "Se actualizó el ancho de la guia";
      $seguimiento._detalle = `${$guia["_anchoGuia"]} ← ${valoresActuales.ancho_guia}`;
      await registrarSeguimientoGuia($seguimiento);
    }
    if ($guia["_altoGuia"] !== valoresActuales.alto_guia) {
      $seguimiento._actividad = "Se actualizó el alto de la guia";
      $seguimiento._detalle = `${$guia["_altoGuia"]} ←  ${valoresActuales.alto_guia}`;
      await registrarSeguimientoGuia($seguimiento);
    }

    const datos = await actualizarDatosGuia($guia);
    cerrarLoader();
    Swal.fire({
      icon: "success",
      title: "Guia actualizada",
      text: datos.message,
    });
  }

  /*=============================================
    - REGISTRAR GUIA DETALLE
  =============================================*/

  async function registrarListadoGuiaDetalle() {
    const idGuia = $("#guia").val();
    const descripcionItem = $("#descripcionItem").val();
    const cantidadItem = $("#cantidadItem").val();
    const unidadItem = $("#unidadItem").val();
    const pesoItem = $("#pesoItem").val();
    if (descripcionItem && cantidadItem && unidadItem && pesoItem) {
      const datos = await registrarGuiaDetalle({
        _idGuia: idGuia,
        _descripcion: descripcionItem,
        _cantidad: cantidadItem,
        _unidad: unidadItem,
        _peso: pesoItem
      });
      Swal.fire({
        icon: "success",
        title: "Guia Detalle",
        text: datos.message
      });
      await mostrarDatosDetalleGuia(idGuia);
    } else {
      Swal.fire({
        icon: "warning",
        title: "Guia Detalle",
        text: "Hay campos pendientes de llenado"
      });
    }
  }

</script>

<!-- SCRIPTS PAGINA 2  -->
<script type="text/javascript">

  async function cargarDocumentosEstadoPreparado() {
    await mostrarProveedoresActivos();
    await mostrarListadoEstadosGuiaTransporte();
    await mostrarDatosGuiaTransporte();
  }

  async function mostrarProveedoresActivos() {
    const datos = await cargarProveedoresActivos();
    var tablaProveedores = "<option value='0' selected disabled> Elegir Proveedor</option>";
    for (const proveedor of datos) {
      tablaProveedores += `
        <option value='${proveedor.id_proveedor}'>${proveedor.ruc} - ${proveedor.razon_social}</option>
      `;
    }
    $("#proveedores").html(tablaProveedores);
    $("#proveedores").select2();
  }

  async function mostrarListadoEstadosGuiaTransporte() {
    const datos = await cargarEstadosGuiaTransporte();
    var tablaEstados = "";
    for (const estados of datos) {
      tablaEstados += `
        <option value='${estados.id_estado_guia_transporte}'>${estados.descripcion}</option>
      `;
    }
    $("#estadoGuiaTransporte").html(tablaEstados);
  }

  async function mostrarDatosGuiaTransporte() {
    const datos = await cargarDatosGuiaTransporteIdGuia({
      _idGuia: $("#guia").val()
    });
    if (datos.response === 0) {
      document.querySelector("#fechaDespacho").valueAsDate = new Date();
      document.getElementById("actualizarTransporte").classList.add("d-none");
      document.getElementById("registrarTransporte").classList.remove("d-none");
      document.getElementById("actualizarEstadoGuia").classList.add("disabled");
    } else {
      $("#codigoGuiaTransporte").val(datos.id_guia_transporte);
      $("#proveedores").val(datos.id_proveedor).trigger('change');
      $("#fechaDespacho").val(datos.fecha_despacho);
      $("#nroGuiaTransporte").val(datos.numero_guia);
      $("#nroFacturaTransporte").val(datos.numero_factura);
      $("#estadoGuiaTransporte").val(datos.id_estado_guia_transporte);
      $("#origenTransporte").val(datos.origen);
      $("#destinoTransporte").val(datos.destino);
      $("#repartoTransporte").val(datos.reparto);
      $("#descripcionTransporte").val(datos.descripcion);
      $("#cantidadBultoTransporte").val(datos.cantidad_bulto);
      $("#observacionesTransporte").val(datos.observaciones);
      $("#subtotalTransporte").val(datos.subtotal);
      $("#igvTransporte").val(datos.igv);
      $("#totalTransporte").val(datos.total);
      $("#tipoTransporte").val(datos.tipo_transporte);
      document.getElementById("actualizarTransporte").classList.remove("d-none");
      document.getElementById("registrarTransporte").classList.add("d-none");
      const estadoInicialGuia = Number($("#estadoInicialGuia").val());
      const estadoActualGuia = Number($("#estadosGuia").val());
      if (estadoInicialGuia < estadoActualGuia) {
        document.getElementById("actualizarEstadoGuia").classList.remove("disabled");
      }
    }
  }

  async function validarFormularioTransporte() {

    const proveedor = $("#proveedores").val();
    const fechaDespacho = $("#fechaDespacho").val();
    const nroGuiaTransporte = $("#nroGuiaTransporte").val();
    const nroFacturaTransporte = $("#nroFacturaTransporte").val();
    const estadoGuiaTransporte = $("#estadoGuiaTransporte").val();
    const origenTransporte = $("#origenTransporte").val();
    const destinoTransporte = $("#destinoTransporte").val();
    const repartoTransporte = $("#repartoTransporte").val();
    const descripcionTransporte = $("#descripcionTransporte").val();
    const cantidadBultoTransporte = $("#cantidadBultoTransporte").val();
    const observacionesTransporte = $("#observacionesTransporte").val();
    const subtotalTransporte = $("#subtotalTransporte").val();
    const igvTransporte = $("#igvTransporte").val();
    const totalTransporte = $("#totalTransporte").val();
    const tipoTransporte = $("#tipoTransporte").val();

    if (subtotalTransporte) {
      var sumaTransporteTotal = Number(subtotalTransporte) + Number(igvTransporte);
      if (sumaTransporteTotal !== Number(totalTransporte)) {
        Swal.fire({
          icon: "error",
          title: "Campo Inválido",
          text: "La suma de el subtotal y el igv no coincide con el total",
        });
        return false;
      }
    }

    await registrarTransporte({
      _idGuia: $("#guia").val(),
      _idProveedor: proveedor,
      _fechaDespacho: fechaDespacho,
      _numeroGuia: nroGuiaTransporte,
      _numeroFactura: nroFacturaTransporte,
      _idEstadoGuiaTransporte: estadoGuiaTransporte,
      _origen: origenTransporte,
      _destino: destinoTransporte,
      _reparto: repartoTransporte,
      _descripcion: descripcionTransporte,
      _cantidadBulto: cantidadBultoTransporte,
      _observaciones: observacionesTransporte,
      _subtotal: subtotalTransporte,
      _igv: igvTransporte,
      _total: totalTransporte,
      _tipoTransporte: tipoTransporte
    });

  }

  async function validarFormularioTransporteActualizar() {
    const proveedor = $("#proveedores").val();
    const fechaDespacho = $("#fechaDespacho").val();
    const nroGuiaTransporte = $("#nroGuiaTransporte").val();
    const nroFacturaTransporte = $("#nroFacturaTransporte").val();
    const estadoGuiaTransporte = $("#estadoGuiaTransporte").val();
    const origenTransporte = $("#origenTransporte").val();
    const destinoTransporte = $("#destinoTransporte").val();
    const repartoTransporte = $("#repartoTransporte").val();
    const descripcionTransporte = $("#descripcionTransporte").val();
    const cantidadBultoTransporte = $("#cantidadBultoTransporte").val();
    const observacionesTransporte = $("#observacionesTransporte").val();
    const subtotalTransporte = $("#subtotalTransporte").val();
    const igvTransporte = $("#igvTransporte").val();
    const totalTransporte = $("#totalTransporte").val();
    const tipoTransporte = $("#tipoTransporte").val();

    await actualizarTransporte({
      _idGuiaTransporte: $("#codigoGuiaTransporte").val(),
      _idGuia: $("#guia").val(),
      _idProveedor: proveedor,
      _fechaDespacho: fechaDespacho,
      _numeroGuia: nroGuiaTransporte,
      _numeroFactura: nroFacturaTransporte,
      _idEstadoGuiaTransporte: estadoGuiaTransporte,
      _origen: origenTransporte,
      _destino: destinoTransporte,
      _reparto: repartoTransporte,
      _descripcion: descripcionTransporte,
      _cantidadBulto: cantidadBultoTransporte,
      _observaciones: observacionesTransporte,
      _subtotal: subtotalTransporte,
      _igv: igvTransporte,
      _total: totalTransporte,
      _tipoTransporte: tipoTransporte
    })
  }

  async function registrarTransporte($guiaTransporte) {
    const datos = await registrarDatosGuiaTransporte($guiaTransporte);
    Swal.fire({
      icon: "success",
      title: "Guia Transporte",
      text: "El transporte de la guia fue registrada correctamente",
    });
    await mostrarDatosGuiaTransporte();
  }

  async function actualizarTransporte($guiaTransporte) {
    const datos = await actualizarDatosGuiaTransporte($guiaTransporte);
    Swal.fire({
      icon: "success",
      title: "Guia Transporte",
      text: "El transporte de la guia fue actualizado correctamente",
    });
    await mostrarDatosGuiaTransporte();
  }

</script>

<!-- SCRIPTS PAGINA 7  -->
<script type="text/javascript">

  /*=============================================
    - ELIMINAR/CANCELAR GUIA
  =============================================*/

  async function actualizarEstadoGuia() {
    cerrarLoader();
    Swal.fire({
      title: "¿Deseas cancelar esta guia?",
      showCancelButton: true,
      confirmButtonText: "Cancelar registro",
      confirmButtonColor: "#d33",
    }).then(async (result) => {
      if (result.isConfirmed) {

        await actualizarEstadoIdGuia({
          _idGuia: $("#guia").val(),
          _idEstadoGuia: $("#estadosGuia").val()
        });

        await registrarSeguimientoGuia({
          _idGuia: $("#guia").val(),
          _numeroGuia: $("#codigo").html(),
          _actividad: "La guia se canceló por el personal logueado",
          _detalle: "-",
          _idPersonal: sessionStorage.id_personal
        });

        ventanaGuiaActualizar();
        Swal.fire({
          icon: "success",
          title: "Guia cancelada",
          text: "La guia se ha cancelado correctamente",
        });

      }
    });

  }
</script>